#!/usr/bin/env python3

import json
from data_cleaner import clean_feishu_records, save_cleaned_data

# 原始数据
original_data = {
    "feishu_records": [
        {
            "fields": {
                "T-1月付费线索量": 81260,
                "T-1月区域线索量": 35431,
                "T-1月咨询留资率": 0.5912003578041858,
                "T-1月场均场观": 492.9094531880549,
                "T-1月场均小风车留资量": 5.92362792574657,
                "T-1月场均曝光人数": 9585.4422417272,
                "T-1月场观": 9771437,
                "T-1月小风车点击": 858951,
                "T-1月小风车点击率": 0.08790426628140774,
                "T-1月小风车点击留资率": 0.136713270023552,
                "T-1月小风车留资": 117430,
                "T-1月广告线索量": 150052,
                "T-1月日均咨询留资人数": 4562.4838709677415,
                "T-1月日均有效（25min以上）时长（h）": 735.5773207885289,
                "T-1月日均私信开口人数": 7717.322580645161,
                "T-1月日均进私人数": 21433.225806451614,
                "T-1月曝光人数": 190021807,
                "T-1月曝光进入率": 0.05142271381515701,
                "T-1月有效直播场次": 19824,
                "T-1月有效直播时长(小时)": 22833.038888888914,
                "T-1月本地线索量": 143013,
                "T-1月消耗": 5672057.239999997,
                "T-1月直播付费CPL": 48.607495350969636,
                "T-1月直播线索": 124714,
                "T-1月直播车云店+区域付费线索量日均": 3764.2258064516127,
                "T-1月直播车云店+区域日均消耗": 182969.58838709668,
                "T-1月短视频发布": 6067,
                "T-1月短视频播放": 37514174,
                "T-1月短视频留资": 707,
                "T-1月私信咨询率": 0.3600635130864049,
                "T-1月私信开口": 239237,
                "T-1月私信留资": 141437,
                "T-1月私信转化率": 0.21286967776891472,
                "T-1月组件点击": 10979,
                "T-1月组件点击率": 0.001189225502133381,
                "T-1月组件留资率": 0.00007658096639113766,
                "T-1月自然线索量": 53504,
                "T-1月进私": 664430,
                "T-1月锚点曝光": 9232059,
                "T月付费线索量": 49499,
                "T月区域线索量": 21721,
                "T月咨询留资率": 0.6103533668651201,
                "T月场均场观": 531.8132250580046,
                "T月场均小风车留资量": 5.678190255220418,
                "T月场均曝光人数": 10246.037896365042,
                "T月场观": 6876345,
                "T月小风车点击": 545828,
                "T月小风车点击率": 0.07937763448459902,
                "T月小风车点击留资率": 0.13450940589343163,
                "T月小风车留资": 73419,
                "T月广告线索量": 91578,
                "T月日均咨询留资人数": 4756.85,
                "T月日均有效（25min以上）时长（h）": 754.9765416666659,
                "T月日均私信开口人数": 7793.6,
                "T月日均进私人数": 20636.25,
                "T月曝光人数": 132481270,
                "T月曝光进入率": 0.051904280506972794,
                "T月有效直播场次": 12930,
                "T月有效直播时长(小时)": 15120.522500000008,
                "T月本地线索量": 89765,
                "T月消耗": 3911672.7200000137,
                "T月直播付费CPL": 54.92379556304428,
                "T月直播线索": 78671,
                "T月直播车云店+区域付费线索量日均": 3561,
                "T月直播车云店+区域日均消耗": 195583.6360000007,
                "T月短视频发布": 3680,
                "T月短视频播放": 42529545,
                "T月短视频留资": 526,
                "T月私信咨询率": 0.37766551577927193,
                "T月私信开口": 155872,
                "T月私信留资": 95137,
                "T月私信转化率": 0.23050941910473075,
                "T月组件点击": 9278,
                "T月组件点击率": 0.0012499518368418118,
                "T月组件留资率": 0.00007086383554416824,
                "T月自然线索量": 35766,
                "T月进私": 412725,
                "T月锚点曝光": 7422686,
                "付费CPL（车云店+区域）": 51.00143131588897,
                "付费线索总量": 130759,
                "区域线索总量": 57152,
                "咨询留资率": 0.5987562925673675,
                "场均场观": 508.26714294437323,
                "场均小风车留资量": 5.826738718935092,
                "场均曝光人数": 9846.219606765586,
                "小风车点击总量": 1404779,
                "小风车点击率": 0.08438235195535357,
                "小风车点击留资率": 0.13585695685940635,
                "小风车留资总量": 190849,
                "层级": "A",
                "广告线索总量": 241630,
                "总场观": 16647782,
                "总曝光人数": 322503077,
                "总消耗": 9583729.960000012,
                "日均咨询留资人数": 4638.705882352941,
                "日均有效（25min以上）时长（h）": 743.1848583877983,
                "日均私信开口人数": 7747.235294117647,
                "日均进私人数": 21120.686274509804,
                "曝光进入率": 0.05162053694141963,
                "有效直播场次总量": 32754,
                "有效直播时长总量(小时)": 37953.56138888892,
                "本地线索占比": 0.7034693260803868,
                "本地线索总量": 232778,
                "直播线索总量": 203385,
                "直播车云店+区域付费线索量日均": 3684.529411764706,
                "直播车云店+区域日均消耗": 187916.27372549044,
                "短视频发布总量": 9747,
                "短视频播放总量": 80043719,
                "短视频留资总量": 1233,
                "私信咨询率": 0.3668079338628145,
                "私信开口总量": 395109,
                "私信留资总量": 236574,
                "私信转化率": 0.21962855856399496,
                "组件点击总量": 20257,
                "组件点击率": 0.0012162900122457594,
                "组件留资率": 0.00007403295577326462,
                "自然线索总量": 89270,
                "车云店+区域综合CPL": 28.962616983983114,
                "进私总量": 1077155,
                "锚点曝光总量": 16654745
            }
        }
    ]
}

if __name__ == "__main__":
    # 应用清理
    cleaned_data = save_cleaned_data(original_data, "cleaned_feishu_data.json")
    print("数据已清理并保存到 cleaned_feishu_data.json")
    
    # 验证清理结果
    with open("cleaned_feishu_data.json", 'r', encoding='utf-8') as f:
        data = json.load(f)
        
    print(f"清理后记录数: {len(data['feishu_records'])}")
    
    # 检查是否有null值
    null_count = 0
    for record in data['feishu_records']:
        for key, value in record['fields'].items():
            if value is None:
                null_count += 1
    
    print(f"剩余的null值数量: {null_count}")
    
    # 显示清理后的数据示例
    if data['feishu_records']:
        sample = data['feishu_records'][0]['fields']
        print("\n清理后的示例字段:")
        for key, value in list(sample.items())[:5]:
            print(f"  {key}: {value} ({type(value).__name__})")